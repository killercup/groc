<!DOCTYPE html><html lang="en"><head><title>styles/solarized/behavior</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../"><meta name="groc-document-path" content="styles/solarized/behavior"><meta name="groc-project-path" content="lib/styles/solarized/behavior.coffee"><meta name="groc-github-url" content="https://github.com/nevir/groc"><link rel="stylesheet" type="text/css" media="all" href="../../assets/style.css"><script type="text/javascript" src="../../assets/behavior.js"></script><body><div id="file-area"><div id="meta"><code class="file-path"><a href="https://github.com/nevir/groc/blob/master/lib/styles/solarized/behavior.coffee">lib/styles/solarized/behavior.coffee</a></code></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="side-menu">Side Menu</h1></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="table-of-contents">Table of Contents</h2>
<p>Schema:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> File, Folder, Headline, index;
Headline = {
  type: <span class="hljs-string">"heading"</span>,
  depth: <span class="hljs-built_in">Number</span>,
  data: {
    level: <span class="hljs-built_in">Number</span>,
    title: <span class="hljs-built_in">String</span>,
    slug: <span class="hljs-built_in">String</span>,
    isFileHeader: <span class="hljs-built_in">Boolean</span>
  },
  children: [Headline]
};
File = {
  type: <span class="hljs-string">"file"</span>,
  depth: <span class="hljs-built_in">Number</span>,
  data: {
    title: <span class="hljs-built_in">String</span>,
    pageTitle: <span class="hljs-built_in">String</span>,
    sourcePath: <span class="hljs-built_in">String</span>,
    projectPath: <span class="hljs-built_in">String</span>,
    targetPath: <span class="hljs-built_in">String</span>,
    language: {
      nameMatchers: [<span class="hljs-built_in">String</span>],
      commentsOnly: <span class="hljs-built_in">Boolean</span>,
      name: <span class="hljs-built_in">String</span>
    },
    firstHeader: Headline
  },
  outline: [Headline],
  children: [(File||Folder)]
};
Folder = {
  type: <span class="hljs-string">"folder"</span>,
  data: {
    path: <span class="hljs-built_in">String</span>,
    title: <span class="hljs-built_in">String</span>
  },
  depth: <span class="hljs-built_in">Number</span>,
  children: [(File||Folder)]
};
index = [(File||Folder)];</code></pre></div></div><div class="code"><div class="wrapper">globalFileTree = &lt;%= JSON.stringify(tableOfContents) %&gt;

$ = Zepto <span class="hljs-keyword">or</span> jQuery</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><h2 id="build-file-tree-recursively">Build File Tree Recursively</h2>
<p>Parameters:</p>
<ul>
<li><p><strong>tree must be an Array.</strong><br/>(List of file or folder Objects)</p>
</li>
<li><p><strong>ul must be a jQuery.</strong><br/>(DOM node of list to append this tree to)</p>
</li>
<li><p><strong>metaInfo must be an Object.</strong><br/>(Project information)</p>
</li>
</ul>
<p><strong>Returns a jQuery</strong><br/>(The ul element)</p></div></div><div class="code"><div class="wrapper"><span class="hljs-function"><span class="hljs-title">buildFileTree</span> = <span class="hljs-params">(tree, ul, metaInfo)</span> -&gt;</span>
  ul = $(ul)
  <span class="hljs-keyword">unless</span> tree?.length
    <span class="hljs-built_in">console</span>.warn <span class="hljs-string">'no tree'</span>, tree
    <span class="hljs-keyword">return</span> ul

  $.each tree, <span class="hljs-function"><span class="hljs-params">(index, node)</span> -&gt;</span>
    $node = $(<span class="hljs-string">"""&lt;li class="<span class="hljs-subst">#{node.type}</span>"/&gt;"""</span>)
    <span class="hljs-keyword">if</span> node.type <span class="hljs-keyword">is</span> <span class="hljs-string">'file'</span>
      currentFile = metaInfo.documentPath <span class="hljs-keyword">is</span> node.data.targetPath
      <span class="hljs-keyword">if</span> currentFile
        <span class="hljs-built_in">console</span>.warn <span class="hljs-string">'duplicate currentFile'</span> <span class="hljs-keyword">if</span> metaInfo.currentFileNode
        metaInfo.currentFileNode = node

      $node.append <span class="hljs-string">"""&lt;a class="label<span class="hljs-subst">#{<span class="hljs-keyword">if</span> currentFile <span class="hljs-keyword">then</span> <span class="hljs-string">' selected'</span> <span class="hljs-keyword">else</span> <span class="hljs-string">''</span>}</span>" href="<span class="hljs-subst">#{metaInfo.relativeRoot}</span><span class="hljs-subst">#{node.data.targetPath}</span>.html" title="<span class="hljs-subst">#{node.data.projectPath}</span>"&gt;&lt;span class="text"&gt;<span class="hljs-subst">#{node.data.title}</span>&lt;/span&gt;&lt;/a&gt;"""</span>
    <span class="hljs-keyword">else</span>
      $node.append <span class="hljs-string">"""&lt;a class="label" data-path="<span class="hljs-subst">#{node.data.path}</span>" href="#"&gt;&lt;span class="text"&gt;<span class="hljs-subst">#{node.data.title}</span>&lt;/span&gt;&lt;/a&gt;"""</span>

    <span class="hljs-keyword">if</span> node.children?.length &gt; <span class="hljs-number">0</span>
      $children = $(<span class="hljs-string">'&lt;ol class="children"/&gt;'</span>)
      $node.append buildFileTree node.children, $children, metaInfo

    ul.append $node
    <span class="hljs-keyword">return</span>

  <span class="hljs-keyword">return</span> ul</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><h2 id="build-headlines-tree-recursively">Build Headlines Tree Recursively</h2>
<p>Parameters:</p>
<ul>
<li><p><strong>tree must be an Object.</strong><br/>(Tree of headlines)</p>
</li>
<li><p><strong>ul must be a jQuery.</strong><br/>(DOM node of list to append this tree to)</p>
</li>
<li><p><strong>metaInfo must be an Object.</strong><br/>(Project information)</p>
</li>
</ul>
<p><strong>Returns a jQuery</strong><br/>(The ul element)</p></div></div><div class="code"><div class="wrapper"><span class="hljs-function"><span class="hljs-title">buildHeadlinesTree</span> = <span class="hljs-params">(tree, ul, metaInfo)</span> -&gt;</span>
  ul = $(ul)
  <span class="hljs-keyword">unless</span> tree?.length
    <span class="hljs-built_in">console</span>.warn <span class="hljs-string">'no tree'</span>, tree
    <span class="hljs-keyword">return</span> ul

  $.each tree, <span class="hljs-function"><span class="hljs-params">(index, node)</span> -&gt;</span>
    $node = $(<span class="hljs-string">"""&lt;li class="<span class="hljs-subst">#{node.type}</span>"/&gt;"""</span>)
    $node.append <span class="hljs-string">"""&lt;a class="label" href="#<span class="hljs-subst">#{node.data.slug}</span>"&gt;&lt;span class="text"&gt;<span class="hljs-subst">#{node.data.title}</span>&lt;/span&gt;&lt;/a&gt;"""</span>

    <span class="hljs-keyword">if</span> node.children?.length &gt; <span class="hljs-number">0</span>
      $children = $(<span class="hljs-string">'&lt;ol class="children"/&gt;'</span>)
      $node.append buildHeadlinesTree node.children, $children, metaInfo

    ul.append $node
    <span class="hljs-keyword">return</span>

  <span class="hljs-keyword">return</span> ul</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><h2 id="create-navigation-element">Create Navigation Element</h2>
<p>Parameters:</p>
<ul>
<li><strong>metaInfo must be an Object.</strong><br/>(Project information)</li>
</ul>
<p><strong>Returns a jQuery</strong><br/>(Navigation element)</p></div></div><div class="code"><div class="wrapper"><span class="hljs-function"><span class="hljs-title">createNav</span> = <span class="hljs-params">(metaInfo)</span> -&gt;</span>
  $nav = $ <span class="hljs-string">"""
    &lt;aside id="side-menu"&gt;
      &lt;nav id="headlines"&gt;
        &lt;details&gt;
          &lt;summary&gt;This File&lt;/summary&gt;
          &lt;ul class="tools"&gt;
            &lt;li class="search"&gt;
              &lt;input id="search-headlines" type="search" autocomplete="off" placeholder="Search"/&gt;
            &lt;/li&gt;
          &lt;/ul&gt;
          &lt;ol class="tree" id="headline-tree"&gt;&lt;/ol&gt;
        &lt;/details&gt;
      &lt;/nav&gt;
      &lt;nav id="files"&gt;
        &lt;details open&gt;
          &lt;summary&gt;Files&lt;/summary&gt;
          &lt;ul class="tools"&gt;
            &lt;li class="search"&gt;
              &lt;input id="search-files" type="search" autocomplete="off" placeholder="Search"/&gt;
            &lt;/li&gt;
          &lt;/ul&gt;
          &lt;ol class="tree" id="file-tree"&gt;&lt;/ol&gt;
        &lt;/details&gt;
      &lt;/nav&gt;
    &lt;/aside&gt;
  """</span>

  <span class="hljs-keyword">return</span> $nav</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><h2 id="add-button-to-toggle-side-menu-visibility">Add Button to Toggle Side Menu Visibility</h2>
<p>Parameters:</p>
<ul>
<li><p><strong>$container must be a jQuery.</strong><br/>(The element the button should be prepended to)</p>
</li>
<li><p><strong>$nav must be a jQuery.</strong><br/>(The navigation element; class &#39;open&#39; will be toggled)</p>
</li>
</ul>
<p><strong>Returns a jQuery</strong><br/>($container element)</p></div></div><div class="code"><div class="wrapper"><span class="hljs-function"><span class="hljs-title">createMenuToggle</span> = <span class="hljs-params">($container, $nav)</span> -&gt;</span>
  $button = $ <span class="hljs-string">"""&lt;button type="button" class="toggle-menu"&gt;
    Menu
  &lt;/button&gt;"""</span>

  $button.<span class="hljs-literal">on</span> <span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-params">(event)</span> -&gt;</span>
    event.preventDefault()
    $nav.toggleClass <span class="hljs-string">'open'</span>

  $container.prepend $button

  <span class="hljs-keyword">return</span> $container</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><h2 id="search-tree">Search Tree</h2>
<p>Parameters:</p>
<ul>
<li><p><strong>$tree must be a jQuery.</strong><br/>(The tree element to be searched)</p>
</li>
<li><p><strong>$search must be a jQuery.</strong><br/>(The search input field)</p>
</li>
</ul></div></div><div class="code"><div class="wrapper"><span class="hljs-function"><span class="hljs-title">searchTree</span> = <span class="hljs-params">($tree, $search)</span> -&gt;</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method throttle</span></p>
<p>Parameters:</p>
<ul>
<li><p><strong>fn must be a Function.</strong><br/>(Callback)</p>
</li>
<li><p><strong>timeout must be a Number.</strong></p>
</li>
</ul></div></div><div class="code"><div class="wrapper">  throttle = <span class="hljs-keyword">do</span><span class="hljs-function"> -&gt;</span>
    <span class="hljs-attribute">timer</span>: <span class="hljs-literal">null</span>
    <span class="hljs-function"><span class="hljs-params">(fn, timeout=<span class="hljs-number">100</span>)</span> -&gt;</span>
      <span class="hljs-built_in">window</span>.clearTimeout timer <span class="hljs-keyword">if</span> timer
      timer = <span class="hljs-built_in">window</span>.setTimeout (<span class="hljs-function">-&gt;</span>
        timer = <span class="hljs-literal">null</span>
        fn?()
      ), timeout</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method search</span></p>
<p>Parameters:</p>
<ul>
<li><p><strong>tree must be a jQuery.</strong></p>
</li>
<li><p><strong>value must be a String.</strong><br/>(Search query)</p>
</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="hljs-function"><span class="hljs-title">search</span> = <span class="hljs-params">($tree, value)</span> -&gt;</span>
    value = value.trim().toLowerCase()
    $tree.find(<span class="hljs-string">'.matched'</span>).removeClass <span class="hljs-string">'matched'</span>

    <span class="hljs-keyword">if</span> value <span class="hljs-keyword">is</span> <span class="hljs-string">""</span>
      <span class="hljs-built_in">console</span>.log <span class="hljs-string">'stop searching'</span>
      $tree.removeClass <span class="hljs-string">'searching'</span>
      <span class="hljs-keyword">return</span>

    $tree.addClass <span class="hljs-string">'searching'</span>
    $tree.find<span class="hljs-function"><span class="hljs-params">(<span class="hljs-string">'a'</span>)</span>.<span class="hljs-title">each</span> <span class="hljs-params">(index, item)</span> -&gt;</span>
      $item = $(item)
      <span class="hljs-keyword">if</span> $item.text().toLowerCase().indexOf(value) &gt; -<span class="hljs-number">1</span> <span class="hljs-keyword">or</span> $item.attr(<span class="hljs-string">'href'</span>).toLowerCase().indexOf(value) &gt; -<span class="hljs-number">1</span>
        $item.addClass <span class="hljs-string">'matched'</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>show folders above matched item</p></div></div><div class="code"><div class="wrapper">        $item.parents(<span class="hljs-string">'li'</span>).children(<span class="hljs-string">'.label'</span>).addClass <span class="hljs-string">'matched'</span>
      <span class="hljs-keyword">return</span>

  value = <span class="hljs-literal">null</span>
  $search.<span class="hljs-literal">on</span> <span class="hljs-string">'keyup search'</span>, <span class="hljs-function"><span class="hljs-params">(event)</span> -&gt;</span>
    newVal = event.target.value
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> newVal <span class="hljs-keyword">is</span> value
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> newVal &lt; <span class="hljs-number">2</span> <span class="hljs-keyword">and</span> newVal <span class="hljs-keyword">isnt</span> <span class="hljs-string">""</span>
    value = newVal
    throttle<span class="hljs-function"> -&gt;</span>
      search($tree, value)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>ESC</p></div></div><div class="code"><div class="wrapper">  $search.<span class="hljs-literal">on</span> <span class="hljs-string">'keydown'</span>, <span class="hljs-function"><span class="hljs-params">(event)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> event.keyCode == <span class="hljs-number">27</span> <span class="hljs-comment"># Esc</span>
      <span class="hljs-keyword">if</span> $search.val().trim() <span class="hljs-keyword">is</span> <span class="hljs-string">''</span>
        $search.blur()
      <span class="hljs-keyword">else</span>
        $search.val <span class="hljs-string">''</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><h2 id="build-navigation">Build Navigation</h2>
<p>Parameters:</p>
<ul>
<li><p><strong>fileTree must be an Array.</strong><br/>(List of Files)</p>
</li>
<li><p><strong>metaInfo must be an Object.</strong><br/>(Project information)</p>
</li>
</ul>
<p><strong>Returns a jQuery</strong><br/>(The nav element)</p></div></div><div class="code"><div class="wrapper"><span class="hljs-function"><span class="hljs-title">buildNav</span> = <span class="hljs-params">(fileTree, metaInfo)</span> -&gt;</span>
  $nav = createNav(metaInfo)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Build file tree
This also sets <code>metaInfo.currentFileNode</code>.</p></div></div><div class="code"><div class="wrapper">  buildFileTree fileTree, $nav.find(<span class="hljs-string">'#file-tree'</span>), metaInfo
  searchTree $nav.find(<span class="hljs-string">'#file-tree'</span>), $nav.find(<span class="hljs-string">'#search-files'</span>)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Build headlines tree</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">if</span> file = metaInfo.currentFileNode
    headlineTree = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">if</span> file.data.firstHeader
      headlineTree = [file.data.firstHeader]
    <span class="hljs-keyword">else</span>
      headlineTree = file.outline

    buildHeadlinesTree headlineTree, $nav.find(<span class="hljs-string">'#headline-tree'</span>), metaInfo
    searchTree $nav.find(<span class="hljs-string">'#headline-tree'</span>), $nav.find(<span class="hljs-string">'#search-headlines'</span>)
  <span class="hljs-keyword">return</span> $nav

$<span class="hljs-function"> -&gt;</span>
  metaInfo =
    <span class="hljs-attribute">relativeRoot</span>: $(<span class="hljs-string">'meta[name="groc-relative-root"]'</span>).attr(<span class="hljs-string">'content'</span>)
    <span class="hljs-attribute">githubURL</span>:    $(<span class="hljs-string">'meta[name="groc-github-url"]'</span>).attr(<span class="hljs-string">'content'</span>)
    <span class="hljs-attribute">documentPath</span>: $(<span class="hljs-string">'meta[name="groc-document-path"]'</span>).attr(<span class="hljs-string">'content'</span>)
    <span class="hljs-attribute">projectPath</span>:  $(<span class="hljs-string">'meta[name="groc-project-path"]'</span>).attr(<span class="hljs-string">'content'</span>)

  $nav = buildNav globalFileTree, metaInfo
  $nav.prependTo $(<span class="hljs-string">'body'</span>)

  createMenuToggle $(<span class="hljs-string">'#meta'</span>), $nav</div></div></div></div></div></body></html>